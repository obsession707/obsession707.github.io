<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <title>数据库表结构查询（Oracle版本） - Rehoni | 罗皓</title>
    <meta property="og:title" content="数据库表结构查询（Oracle版本） - Rehoni | 罗皓">
    
    <meta name="twitter:card" content="summary">

    
      
    

    
      
      <meta property="description" content="直接贴代码
[&amp;hellip;] SELECT -- t1.Table_Name AS 表名称, -- t3.comments AS 表说明, t2.COMMENTS as 名称, t1.Column_Name AS 代码, concat(concat(t1.DATA_TYPE, &amp;#39;(&amp;#39;), concat(t1.DATA_LENGTH, &amp;#39;)&amp;#39;)) as 数据类型, &amp;hellip;">
      <meta property="og:description" content="直接贴代码
[&amp;hellip;] SELECT -- t1.Table_Name AS 表名称, -- t3.comments AS 表说明, t2.COMMENTS as 名称, t1.Column_Name AS 代码, concat(concat(t1.DATA_TYPE, &amp;#39;(&amp;#39;), concat(t1.DATA_LENGTH, &amp;#39;)&amp;#39;)) as 数据类型, &amp;hellip;">
      
    

    
    
    
    <meta name="twitter:image" content="/images/logo.png">
    
    

    

    
    


<link href='//cdn.bootcdn.net/ajax/libs/highlight.js/10.1.0/styles/github.min.css' rel='stylesheet' type='text/css' />



    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
<script async src="/js/load-typekit.js"></script>


<link rel="stylesheet" href="/css/custom.css" />

  </head>

  
  <body class="cn">
    <header class="masthead">
      

<h1><a href="/"><img src="/images/logo.png" alt="Luo Hao" /></a></h1>



      <nav class="menu">
  <ul>
  
  
  <li><a href="/">首页</a></li>
  
  <li><a href="/cn/about/">关于</a></li>
  
  <li><a href="/cn/">日志</a></li>
  
  <li><a href="/categories/">分类</a></li>
  
  <li><a href="/tags/">标签</a></li>
  
  <li><a href="/cn/vitae/">简历</a></li>
  
  <li><a href="/en/">English</a></li>
  
  

<li class="menu-extra"></li>



<li><a href="https://github.com/rehonicn%5c2020-06-20-Oracle%e8%a1%a8%e7%bb%93%e6%9e%84%e6%9f%a5%e8%af%a2.md" target="_blank">编辑</a></li>


<li><a href="/cn/index.xml" type="application/rss+xml" title="RSS feed">订阅</a></li>

<li><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="Attribution-NonCommercial-ShareAlike 4.0 International">版权</a></li>


  </ul>
</nav>

    </header>

    <article class="main">
      <header class="title">
      
<h1>数据库表结构查询（Oracle版本）</h1>


<h3>Rehoni / 
2020-04-08</h3>

<hr>


      </header>



<p>直接贴代码</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span>
<span style="color:#75715e">-- t1.Table_Name AS 表名称,
</span><span style="color:#75715e">-- t3.comments AS 表说明,
</span><span style="color:#75715e"></span>t2.COMMENTS                                                    <span style="color:#66d9ef">as</span> <span style="color:#960050;background-color:#1e0010">名称</span>,
t1.<span style="color:#66d9ef">Column_Name</span>                                                 <span style="color:#66d9ef">AS</span> <span style="color:#960050;background-color:#1e0010">代码</span>,
concat(concat(t1.DATA_TYPE, <span style="color:#e6db74">&#39;(&#39;</span>), concat(t1.DATA_LENGTH, <span style="color:#e6db74">&#39;)&#39;</span>)) <span style="color:#66d9ef">as</span> <span style="color:#960050;background-color:#1e0010">数据类型</span>,
<span style="color:#66d9ef">case</span>
    <span style="color:#66d9ef">when</span> (<span style="color:#66d9ef">select</span> <span style="color:#66d9ef">count</span>(<span style="color:#f92672">*</span>)
          <span style="color:#66d9ef">from</span> user_cons_columns <span style="color:#66d9ef">c</span>
          <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">c</span>.<span style="color:#66d9ef">table_name</span> <span style="color:#f92672">=</span> t1.<span style="color:#66d9ef">TABLE_NAME</span>
            <span style="color:#66d9ef">and</span> <span style="color:#66d9ef">c</span>.<span style="color:#66d9ef">column_name</span> <span style="color:#f92672">=</span> t1.<span style="color:#66d9ef">COLUMN_NAME</span>
            <span style="color:#66d9ef">and</span> <span style="color:#66d9ef">c</span>.<span style="color:#66d9ef">constraint_name</span> <span style="color:#f92672">=</span>
                (<span style="color:#66d9ef">select</span> d.<span style="color:#66d9ef">constraint_name</span>
                 <span style="color:#66d9ef">from</span> user_constraints d
                 <span style="color:#66d9ef">where</span> d.<span style="color:#66d9ef">table_name</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">c</span>.<span style="color:#66d9ef">table_name</span>
                   <span style="color:#66d9ef">and</span> d.constraint_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;P&#39;</span>)
         ) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> <span style="color:#66d9ef">then</span> <span style="color:#e6db74">&#39;1&#39;</span>
    <span style="color:#66d9ef">else</span> <span style="color:#e6db74">&#39;0&#39;</span> <span style="color:#66d9ef">end</span>                                               <span style="color:#66d9ef">as</span> <span style="color:#960050;background-color:#1e0010">是键</span>,
t2.Comments                                                    <span style="color:#66d9ef">AS</span> <span style="color:#960050;background-color:#1e0010">注释</span>

<span style="color:#66d9ef">FROM</span> cols t1
         <span style="color:#66d9ef">left</span> <span style="color:#66d9ef">join</span> user_col_comments t2
                   <span style="color:#66d9ef">on</span> t1.<span style="color:#66d9ef">Table_name</span> <span style="color:#f92672">=</span> t2.<span style="color:#66d9ef">Table_name</span> <span style="color:#66d9ef">and</span> t1.<span style="color:#66d9ef">Column_Name</span> <span style="color:#f92672">=</span> t2.<span style="color:#66d9ef">Column_Name</span>
         <span style="color:#66d9ef">left</span> <span style="color:#66d9ef">join</span> user_tab_comments t3
                   <span style="color:#66d9ef">on</span> t1.<span style="color:#66d9ef">Table_name</span> <span style="color:#f92672">=</span> t3.<span style="color:#66d9ef">Table_name</span>
<span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span>(<span style="color:#66d9ef">SELECT</span> t4.Object_Name
                 <span style="color:#66d9ef">FROM</span> User_objects t4
                 <span style="color:#66d9ef">WHERE</span> t4.Object_Type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;TABLE&#39;</span>
                   <span style="color:#66d9ef">AND</span> t4.<span style="color:#66d9ef">Temporary</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Y&#39;</span>
                   <span style="color:#66d9ef">AND</span> t4.Object_Name <span style="color:#f92672">=</span> t1.<span style="color:#66d9ef">Table_Name</span>)
  <span style="color:#66d9ef">AND</span> t1.<span style="color:#66d9ef">TABLE_NAME</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;CLEAND_TMS_DEVICE&#39;</span>
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> t1.<span style="color:#66d9ef">Table_Name</span>, t1.Column_ID;

<span style="color:#75715e">-- 基本
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> t1.<span style="color:#66d9ef">Table_Name</span> <span style="color:#66d9ef">AS</span> <span style="color:#960050;background-color:#1e0010">表名称</span>,
t3.comments <span style="color:#66d9ef">AS</span> <span style="color:#960050;background-color:#1e0010">表说明</span>,
t1.<span style="color:#66d9ef">Column_Name</span> <span style="color:#66d9ef">AS</span> <span style="color:#960050;background-color:#1e0010">字段名称</span>,
t1.Data_Type <span style="color:#66d9ef">AS</span> <span style="color:#960050;background-color:#1e0010">数据类型</span>,
t1.Data_Length <span style="color:#66d9ef">AS</span> <span style="color:#960050;background-color:#1e0010">长度</span>,
concat(concat(t1.DATA_TYPE,<span style="color:#e6db74">&#39;(&#39;</span>),concat(t1.DATA_LENGTH,<span style="color:#e6db74">&#39;)&#39;</span>)) <span style="color:#66d9ef">as</span> <span style="color:#960050;background-color:#1e0010">数据类型</span>,
t1.<span style="color:#66d9ef">NullAble</span> <span style="color:#66d9ef">AS</span> <span style="color:#960050;background-color:#1e0010">是否为空</span>,
t2.Comments <span style="color:#66d9ef">AS</span> <span style="color:#960050;background-color:#1e0010">字段说明</span>

<span style="color:#66d9ef">FROM</span> cols t1 <span style="color:#66d9ef">left</span> <span style="color:#66d9ef">join</span> user_col_comments t2
<span style="color:#66d9ef">on</span> t1.<span style="color:#66d9ef">Table_name</span><span style="color:#f92672">=</span>t2.<span style="color:#66d9ef">Table_name</span> <span style="color:#66d9ef">and</span> t1.<span style="color:#66d9ef">Column_Name</span><span style="color:#f92672">=</span>t2.<span style="color:#66d9ef">Column_Name</span>
<span style="color:#66d9ef">left</span> <span style="color:#66d9ef">join</span> user_tab_comments t3
<span style="color:#66d9ef">on</span> t1.<span style="color:#66d9ef">Table_name</span><span style="color:#f92672">=</span>t3.<span style="color:#66d9ef">Table_name</span>
<span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> ( <span style="color:#66d9ef">SELECT</span> t4.Object_Name <span style="color:#66d9ef">FROM</span> User_objects t4
<span style="color:#66d9ef">WHERE</span> t4.Object_Type<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;TABLE&#39;</span>
<span style="color:#66d9ef">AND</span> t4.<span style="color:#66d9ef">Temporary</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Y&#39;</span>
<span style="color:#66d9ef">AND</span> t4.Object_Name<span style="color:#f92672">=</span>t1.<span style="color:#66d9ef">Table_Name</span> )
<span style="color:#66d9ef">AND</span> t1.<span style="color:#66d9ef">TABLE_NAME</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;GEA_SP_PD_DEFECT_CAUSE_REL&#39;</span>
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> t1.<span style="color:#66d9ef">Table_Name</span>, t1.Column_ID;

<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> COLS;
<span style="color:#75715e">-- 提取列名，数据类型和长度
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> COLUMN_ID,<span style="color:#66d9ef">COLUMN_NAME</span>,DATA_TYPE,DATA_LENGTH <span style="color:#66d9ef">from</span> cols
<span style="color:#66d9ef">where</span> <span style="color:#66d9ef">TABLE_NAME</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;GEA_SP_PD_DEFECT_CAUSE_REL&#39;</span>;
<span style="color:#75715e">-- 提取列名，列备注
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#66d9ef">COLUMN_NAME</span>,COMMENTS <span style="color:#66d9ef">from</span> USER_COL_COMMENTS
<span style="color:#66d9ef">where</span> <span style="color:#66d9ef">TABLE_NAME</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;GEA_SP_PD_DEFECT_CAUSE_REL&#39;</span>;
<span style="color:#75715e">-- 记录表名，表类型和表备注
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> <span style="color:#66d9ef">TABLE_NAME</span>,COMMENTS <span style="color:#66d9ef">from</span> USER_TAB_COMMENTS
    <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">TABLE_NAME</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;GEA_SP_PD_DEFECT_CAUSE_REL&#39;</span>;
<span style="color:#75715e">-- 无表说明和字段说明的简单版
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> t.<span style="color:#66d9ef">TABLE_NAME</span> <span style="color:#960050;background-color:#1e0010">表名</span> ,t.COLUMN_ID <span style="color:#960050;background-color:#1e0010">序号</span>,t.<span style="color:#66d9ef">COLUMN_NAME</span> <span style="color:#960050;background-color:#1e0010">字段名</span> ,t.DATA_TYPE <span style="color:#960050;background-color:#1e0010">类型</span> ,t.DATA_LENGTH <span style="color:#960050;background-color:#1e0010">长度</span> ,t.<span style="color:#66d9ef">NULLABLE</span> <span style="color:#960050;background-color:#1e0010">是否为空</span>
<span style="color:#66d9ef">from</span> user_tab_columns t
</code></pre></div><h5 id="遗留问题">遗留问题</h5>
<p>当字段<code>DATA_TYPE</code>为<code>NUMBER</code>时，即数据类型是number时，<code>DATA_LENGTH</code>默认为22</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">concat(concat(DATA_TYPE, <span style="color:#e6db74">&#39;(&#39;</span>), concat(DATA_LENGTH, <span style="color:#e6db74">&#39;)&#39;</span>)) <span style="color:#66d9ef">as</span> <span style="color:#960050;background-color:#1e0010">数据类型</span>
</code></pre></div><p>这个时候要看<code>DATA_PRECISION</code>和<code>DATA_SCALE</code>，<code>number(n,m)</code>前者为n后者为m。</p>
<p>所以需要针对<code>NUMBER</code>类型重新拼接。</p>


  <footer>
  
<nav class="post-nav">
  <span class="nav-prev">&larr; <a href="/cn/2020-03-16-%E5%A4%A7%E4%BD%ACqa/">QA：记录最近和大佬交流</a></span>
  <span class="nav-next"><a href="/cn/2020-04-15-word%E8%A1%A8%E7%BB%93%E6%9E%84%E8%BD%ACsql/">word转sql表结构</a> &rarr;</span>
</nav>
<script type="text/javascript">
document.addEventListener('keyup', function(e) {
  if (e.target.nodeName.toUpperCase() != 'BODY') return;
  var url = false;
  if (e.which == 37) {  
    
    url = '\/cn\/2020-03-16-%E5%A4%A7%E4%BD%ACqa\/';
    
  } else if (e.which == 39) {  
    
    url = '\/cn\/2020-04-15-word%E8%A1%A8%E7%BB%93%E6%9E%84%E8%BD%ACsql\/';
    
  }
  if (url) window.location = url;
});
</script>






<script async src="/js/fix-toc.js"></script>

<script async src="/js/center-img.js"></script>

<script async src="/js/right-quote.js"></script>

<script async src="/js/no-highlight.js"></script>

<script async src="/js/fix-footnote.js"></script>

<script async src="/js/math-code.js"></script>

<script async src="/js/external-link.js"></script>

<script async src="/js/alt-title.js"></script>

<script async src="/js/header-link.js"></script>




  



<script src="//cdn.bootcdn.net/ajax/libs/highlight.js/10.1.0/highlight.min.js"></script>



<script src="//cdn.bootcdn.net/ajax/libs/highlight.js/10.1.0/languages/java.min.js"></script>
<script src="//cdn.bootcdn.net/ajax/libs/highlight.js/10.1.0/languages/SQL.min.js"></script>
<script src="//cdn.bootcdn.net/ajax/libs/highlight.js/10.1.0/languages/CSS.min.js"></script>
<script src="//cdn.bootcdn.net/ajax/libs/highlight.js/10.1.0/languages/C#.min.js"></script>
<script>hljs.configure({languages: []}); hljs.initHighlightingOnLoad();</script>



  
  <hr>
  <div class="copyright">© <a href="/">Luo Hao</a> 2016 - 2019</div>
  
  </footer>
  </article>
  
  </body>
</html>

